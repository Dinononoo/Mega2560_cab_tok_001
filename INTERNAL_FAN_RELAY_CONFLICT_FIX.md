# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Ultra-Precise Timing ‡πÅ‡∏•‡∏∞ RELAY Command

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö
Internal Fan ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å:

1. **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á**: ESP32 ‡∏™‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á `FAN_TIMING:K5,5,5` ‡πÅ‡∏•‡∏∞ `RELAY:` command
2. **Mega ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï**: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
3. **RELAY command ‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ**: ‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏Å‡∏±‡∏ö Ultra-Precise Timing

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ESP32 - ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πà‡∏á RELAY command ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Internal Fan

```cpp
// K5 (Internal Fan) - ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà 10
// ‚ö†Ô∏è Internal Fan ‡πÉ‡∏ä‡πâ Ultra-Precise Timing - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á RELAY command
// ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Mega ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ timing ‡πÄ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á FAN_TIMING
// if (fan_internal_state) {
//     currentRelayCommand.setCharAt(10, '1');
// }
```

### 2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Internal Fan ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà

```cpp
// ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Internal Fan ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Mega ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
Serial2.println("FAN_RESET:K5");
Serial.println("üîÑ Sent Internal Fan reset command to Mega: FAN_RESET:K5");
```

### 3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Internal Fan ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å MQTT

```cpp
// ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Internal Fan ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Mega ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
Serial2.println("FAN_RESET:K5");
Serial.println("üîÑ Sent Internal Fan reset command to Mega: FAN_RESET:K5");
```

### 4. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç executeControlLogic() ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á FAN_TIMING ‡πÅ‡∏ó‡∏ô RELAY

```cpp
// ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Ultra-Precise Timing ‡πÑ‡∏õ Mega ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
String timingCommand = "FAN_TIMING:K5," + String(controlSettings.internal_fan_delay_on) + "," + String(controlSettings.internal_fan_delay_off);
Serial2.println(timingCommand);
Serial.println("üåÄ ULTRA-PRECISE: Internal Fan timing sent to Mega2560");
```

### 5. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏õ‡∏¥‡∏î Internal Fan ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤

```cpp
// ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏õ‡∏¥‡∏î Internal Fan ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Mega
Serial2.println("FAN_OFF:K5");
Serial.println("üåÄ Sent Internal Fan OFF command to Mega: FAN_OFF:K5");
```

### 6. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Mega - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á FAN_RESET ‡πÅ‡∏•‡∏∞ FAN_OFF

```cpp
// ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Internal Fan: FAN_RESET:K5
if (command.startsWith("FAN_RESET:K")) {
  // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Internal Fan cycle
  fanCycleActive = false;
  fanCycleStartTime = 0;
  fanCycleState = false;
  
  // ‡∏õ‡∏¥‡∏î relay K5 (Internal Fan) ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  relayStates[relayNum] = false;
  // ... control relay
}

// ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏õ‡∏¥‡∏î Internal Fan: FAN_OFF:K5
if (command.startsWith("FAN_OFF:K")) {
  // ‡∏õ‡∏¥‡∏î relay K5 (Internal Fan) ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  relayStates[relayNum] = false;
  // ... control relay
}
```

## ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. ‡∏´‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï/‡πÑ‡∏ü‡∏î‡∏±‡∏ö
1. ESP32 ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å NVS
2. ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `FAN_RESET:K5` ‡πÑ‡∏õ Mega
3. Mega ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Internal Fan cycle ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î relay
4. ESP32 ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `FAN_TIMING:K5,5,5` ‡πÑ‡∏õ Mega
5. Mega ‡πÄ‡∏£‡∏¥‡πà‡∏° Ultra-Precise Timing cycle

### 2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å MQTT
1. ESP32 ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
2. ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `FAN_RESET:K5` ‡πÑ‡∏õ Mega
3. Mega ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Internal Fan cycle ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î relay
4. ESP32 ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `FAN_TIMING:K5,5,5` ‡πÑ‡∏õ Mega
5. Mega ‡πÄ‡∏£‡∏¥‡πà‡∏° Ultra-Precise Timing cycle ‡πÉ‡∏´‡∏°‡πà

### 3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
1. ESP32 ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
2. ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `FAN_OFF:K5` ‡πÑ‡∏õ Mega
3. Mega ‡∏õ‡∏¥‡∏î relay K5 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

## ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

1. **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á**: ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πà‡∏á RELAY command ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Internal Fan
2. **‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥**: Internal Fan ‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
3. **Ultra-Precise Timing**: Mega ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ timing ‡πÄ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á
4. **‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô**: ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï, ‡πÄ‡∏õ‡∏¥‡∏î, ‡∏õ‡∏¥‡∏î ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô

## ‡∏™‡∏£‡∏∏‡∏õ

‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ Internal Fan ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï ‡πÇ‡∏î‡∏¢:
- ‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Ultra-Precise Timing ‡πÅ‡∏•‡∏∞ RELAY command
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î Internal Fan
- ‡πÉ‡∏´‡πâ Mega ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ timing ‡πÄ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- Internal Fan ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ
